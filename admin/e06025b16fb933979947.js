(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{337:function(t,e,i){},360:function(t,e,i){"use strict";var s=i(337);i.n(s).a},367:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=this,i=e.$createElement,s=e._self._c||i;return s("div",{staticClass:"edit-form"},[s("card",{attrs:{title:e.editFormTitle}},[s("template",{slot:"content"},[s("div",{staticClass:"edit-form__container"},[s("div",{staticClass:"edit-form__col"},[e.renderedPhoto.length?s("div",{staticClass:"edit-form__btn"},[s("div",{staticClass:"edit-form__pic",style:{backgroundImage:e.renderedPhoto}}),s("label",{staticClass:"edit-form__change-preview"},[s("a",{staticClass:"edit-form__change-pic"},[e._v("Изменить превью")]),s("input",{staticClass:"edit-form__preview-input",attrs:{type:"file"},on:{change:e.handlePhotoUpload}})])]):s("label",{staticClass:"edit-from__picture"},[s("div",{staticClass:"edit-form__picture-text"},[e._v("Перетащите либо загрузите изображения")]),s("app-button",{attrs:{elem:"file",text:"Загрузить"},on:{change:e.handlePhotoUpload}})],1)]),s("div",{staticClass:"edit-form__col"},[s("div",{staticClass:"edit-form__row"},[s("app-input",{attrs:{title:"Название"},model:{value:e.newWork.title,callback:function(t){e.$set(e.newWork,"title",t)},expression:"newWork.title"}})],1),s("div",{staticClass:"edit-form__row"},[s("app-input",{attrs:{title:"Ссылка"},model:{value:e.newWork.link,callback:function(t){e.$set(e.newWork,"link",t)},expression:"newWork.link"}})],1),s("div",{staticClass:"edit-form__row"},[s("app-input",{attrs:{title:"Описание",fieldType:"textarea"},model:{value:e.newWork.description,callback:function(t){e.$set(e.newWork,"description",t)},expression:"newWork.description"}})],1),s("div",{staticClass:"edit-form__row"},[s("add-tags",{on:{removeTag:function(e){return t.newWork.techs=e}},model:{value:e.newWork.techs,callback:function(t){e.$set(e.newWork,"techs",t)},expression:"newWork.techs"}})],1)])]),s("div",{staticClass:"edit-form__buttons"},[s("div",{staticClass:"edit-form__buttons-item"},[s("app-button",{staticClass:"plain",attrs:{text:"Отмена"},on:{click:e.cancelAdding}})],1),s("div",{staticClass:"edit-form__buttons-item"},[s("app-button",{attrs:{text:"Загрузить",disabled:e.disabled},on:{click:e.addNewWork}})],1)])])],2)],1)};s._withStripped=!0;var o=i(39);var a={props:{mode:{type:String,default:"add",validator:t=>["add","edit"].includes(t)},disabled:{type:Boolean,default:!1}},components:{card:()=>i.e(1).then(i.bind(null,375)),appInput:()=>i.e(0).then(i.bind(null,377)),appButton:()=>i.e(11).then(i.bind(null,381)),addTags:()=>i.e(10).then(i.bind(null,376))},data:()=>({renderedPhoto:"",newWork:{title:"",techs:"",link:"",photo:"",description:""}}),computed:{editFormTitle(){switch(this.mode){case"edit":return"Редактирование работы";case"add":return"Добавление работы"}}},methods:{...Object(o.b)("works",["storeWork"]),...Object(o.b)("tooltips",["showTooltip"]),async addNewWork(){this.disabled=!0;try{await this.storeWork(this.newWork);this.$emit("closeForm"),this.clearFormFields(),this.showTooltip({text:"Работа создана",type:"success"})}catch(t){this.showTooltip({type:"error",text:t.message})}finally{this.disabled=!1}},cancelAdding(){this.clearFormFields(),this.$emit("closeForm")},clearFormFields(){Object.keys(this.newWork).forEach(t=>{this.newWork[t]=""}),this.renderedPhoto=""},async handlePhotoUpload(t){const e=t.target.files[0];this.newWork.photo=e;try{const t=await(t=>{const e=new FileReader;return new Promise((i,s)=>{try{e.readAsDataURL(t),e.onloadend=(()=>{i(e.result)})}catch(t){throw new Error("Ошибка при чтении файла")}})})(e);this.renderedPhoto=`url(${t})`}catch(t){this.showTooltip({type:"error",text:t.message})}}}},r=(i(360),i(93)),n=Object(r.a)(a,s,[],!1,null,"07f536f6",null);n.options.__file="src/admin/components/works-add.vue";e.default=n.exports}}]);